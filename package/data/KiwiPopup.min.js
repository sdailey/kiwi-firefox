(function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__hasProp={}.hasOwnProperty,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};$().ready(function(){var Conversations,Credits,CustomSearch,FixedView,KiwiSlice,Loading,SwitchView,UserPreferences,View,Widget,bindGoToViewButtons,capitalizeFirstLetter,fixedViews,formatTime,getRandom,getURLParam,htmlEntities,initialize,moveArrayElement,preferencesOnlyPage,receiveParcel,renderExtensionHeight,renderedBool,sendParcel,switchViews,tailorRedditAndHNresults_returnHtml,tailorResults,viewElementId,_tailorHNcomment;return viewElementId="",renderedBool=!1,preferencesOnlyPage=!1,initialize=function(popupParcel){var view,viewName;for(viewName in fixedViews)view=fixedViews[viewName],view.init(popupParcel);return null!=popupParcel.view&&null!=switchViews[popupParcel.view]?switchViews[popupParcel.view].render(popupParcel):switchViews.conversations.render(popupParcel)},Widget=function(){function Widget(_at_name,_at_parentView,_at___renderStates__){return this.name=_at_name,this.parentView=_at_parentView,this.__renderStates__=_at___renderStates__,this.render=__bind(this.render,this),this.elsToUnbind=[],this.DOMselector=this.parentView.DOMselector+" #"+this.name+"_Widget",this.totalRenders=0,this.bindAllGoToViewButtons=function(_this){return function(viewData){var els_goTo_view,viewValue,_results,_viewName;_results=[];for(_viewName in switchViews)viewValue=switchViews[_viewName],els_goTo_view=$(_this.DOMselector+" .goTo_"+_viewName+"View"),_this.elsToUnbind.push(els_goTo_view),_results.push(bindGoToViewButtons(els_goTo_view,_viewName,viewData));return _results}}(this),this.unbindWidget=function(_this){return function(){var el,_i,_len,_ref;for(_ref=_this.elsToUnbind,_i=0,_len=_ref.length;_len>_i;_i++)el=_ref[_i],el.unbind();return _this.elsToUnbind=[]}}(this),this.renderStates=this.__renderStates__(),this}return Widget.prototype.render=function(renderState,popupParcel){return this.unbindWidget(this.name),this.totalRenders++,this.renderStates[renderState].paint(popupParcel),this.bindAllGoToViewButtons(popupParcel),this.renderStates[renderState].bind(popupParcel)},Widget}(),CustomSearch=function(_super){function CustomSearch(_at_name,_at_parentView,_at_widgetOpenBool){this.name=_at_name,this.parentView=_at_parentView,this.widgetOpenBool=_at_widgetOpenBool,this.__renderStates__=__bind(this.__renderStates__,this),CustomSearch.__super__.constructor.call(this,this.name,this.parentView,this.__renderStates__)}return __extends(CustomSearch,_super),CustomSearch.prototype.init=function(popupParcel){return this.unbindWidget(),this.widgetOpenBool===!1?this.render("collapsed",popupParcel):this.render("opened",popupParcel)},CustomSearch.prototype.__renderStates__=function(){return{collapsed:{paint:function(_this){return function(popupParcel){var duplicateFixedHeight,openedCustomSearchHTML;return openedCustomSearchHTML='<div class="topSearchBar" style="padding-bottom: 14px;"> <div class="evenlySpacedContainer"> <input class="queryInputOpen" id="customSearchQueryInput" type="text" placeholder=" combined search" /> <button class="btn btn-mini btn-default goTo_userPreferencesView">User Options <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></button> </div>',null!=popupParcel.kiwi_customSearchResults.queryString&&""!==popupParcel.kiwi_customSearchResults.queryString&&(openedCustomSearchHTML+="<div style='padding-top: 12px;'><a id='openPreviousSearch'>see custom results for '"+popupParcel.kiwi_customSearchResults.queryString+"' </a> &nbsp;&nbsp;&nbsp;&nbsp; <a id='clearPreviousSearch'>clear</a> </div>"),openedCustomSearchHTML+="</div> <div class='notFixed'></div>",$(_this.DOMselector).html(openedCustomSearchHTML),(duplicateFixedHeight=function(){var fixedElHeight;return fixedElHeight=$(_this.DOMselector+" .topSearchBar").outerHeight(),0===fixedElHeight?setTimeout(function(){return duplicateFixedHeight()},80):$(_this.DOMselector+" .notFixed").css({height:fixedElHeight+"px"})})()}}(this),bind:function(_this){return function(popupParcel){var clearPreviousSearch,inputSearchQueryInput,previousSearchLink;return inputSearchQueryInput=$("#customSearchQueryInput"),previousSearchLink=$("#openPreviousSearch"),clearPreviousSearch=$("#clearPreviousSearch"),_this.elsToUnbind=_this.elsToUnbind.concat(inputSearchQueryInput,previousSearchLink,clearPreviousSearch),previousSearchLink.bind("click",function(){return $("#customSearchQueryInput").click()}),clearPreviousSearch.bind("click",function(){var parcel;return parcel={msg:"kiwiPP_refreshSearchQuery"},sendParcel(parcel)}),inputSearchQueryInput.bind("click",function(){return _this.widgetOpenBool=!0,_this.render("opened",popupParcel)})}}(this)},opened:{paint:function(_this){return function(popupParcel){var activeClass,ariaPressedState,customSearchResultsHTML,duplicateFixedHeight,index,openedCustomSearchHTML,queryString,resultsSummaryArray,serviceDisabledAttr,serviceInfoObject,service_PreppedResults,tagActiveChecked,tagDisabledAttr,tagName,tagObject,_i,_j,_len,_len1,_ref,_ref1,_ref2;for(queryString=null!=popupParcel.kiwi_customSearchResults.queryString?popupParcel.kiwi_customSearchResults.queryString:"",openedCustomSearchHTML='<div class="topSearchBar"> <div class="evenlySpacedContainer"> <input id="customSearchQueryInput" value="'+queryString+'" type="text" placeholder=" combined search" style="width:234px; margin-right: 10px;" /> <button  class="btn btn-mini btn-default" id="customSearchQuerySubmit" style="margin-right: 10px;">Submit</button> <button style="" class="goTo_userPreferencesView btn btn-mini btn-default"> Options <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></button> </div> <br> <div class="evenlySpacedContainer" style="position: relative; top: -8px; margin-bottom: 3px;">',_ref=popupParcel.kiwi_servicesInfo,_i=0,_len=_ref.length;_len>_i;_i++){if(serviceInfoObject=_ref[_i],openedCustomSearchHTML+="<div>",serviceDisabledAttr="off"===serviceInfoObject.active?' disabled title="Service must be active, can be changed in options." ':" ",null!=popupParcel.kiwi_customSearchResults.servicesSearchesRequested&&null!=popupParcel.kiwi_customSearchResults.servicesSearchesRequested[serviceInfoObject.name]?(activeClass=" active ",ariaPressedState="true"):null==popupParcel.kiwi_customSearchResults.servicesSearchesRequested?(activeClass="off"===serviceInfoObject.active?" ":" active ",ariaPressedState="off"===serviceInfoObject.active?"false":"true"):(activeClass=" ",ariaPressedState="false"),null!=serviceInfoObject.customSearchTags&&Object.keys(serviceInfoObject.customSearchTags).length>0){openedCustomSearchHTML+='<div class="btn-group"> <button data-toggle="button" aria-pressed="'+ariaPressedState+'" autocomplete="off" '+serviceDisabledAttr+'class="servicesToSearch btn btn-default btn-mini dropdownLabel '+activeClass+'" data-serviceName="'+serviceInfoObject.name+'">'+serviceInfoObject.title+"</button> <button "+serviceDisabledAttr+' data-toggle="dropdown" class="btn btn-default dropdown-toggle '+activeClass+"dropDownPrefs_"+serviceInfoObject.name+'" data-placeholder="false"><span class="caret"></span></button> <ul class="dropdown-menu">',_ref1=serviceInfoObject.customSearchTags;for(tagName in _ref1)tagObject=_ref1[tagName],tagActiveChecked=null!=popupParcel.kiwi_customSearchResults.servicesSearchesRequested&&null!=popupParcel.kiwi_customSearchResults.servicesSearchesRequested[serviceInfoObject.name]?null!=popupParcel.kiwi_customSearchResults.servicesSearchesRequested[serviceInfoObject.name].customSearchTags[tagName]?" checked ":"":tagObject.include===!0?" checked ":"",tagDisabledAttr="off"===serviceInfoObject.active?' disabled title="Service must be active, can be changed in options." ':"",openedCustomSearchHTML+="<li><input "+tagActiveChecked+tagDisabledAttr+' type="checkbox" value="'+tagName+'" class="tagPref tagPref_'+serviceInfoObject.name+'" id="'+serviceInfoObject.name+tagName+'"> <label for="'+serviceInfoObject.name+tagName+'">'+tagObject.title+"</label></li>";openedCustomSearchHTML+="</ul></div>"}else openedCustomSearchHTML+='<button data-toggle="button" aria-pressed="'+ariaPressedState+'" autocomplete="off" type="button" class="servicesToSearch btn btn-mini btn-default  '+activeClass+'" data-serviceName="'+serviceInfoObject.name+'">'+serviceInfoObject.title+"</button>";openedCustomSearchHTML+="</div>"}if(openedCustomSearchHTML+='<div> <button aria-pressed="false" autocomplete="off" type="button" class="btn btn-mini btn-default" id="close__'+_this.name+'" > close <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> </button> </div> </div>',openedCustomSearchHTML+='</div> <div class="notFixed"></div> <div id="customSearchResults"></div>',resultsSummaryArray=[],customSearchResultsHTML="",null!=popupParcel.kiwi_customSearchResults&&null!=popupParcel.kiwi_customSearchResults.queryString&&""!==popupParcel.kiwi_customSearchResults.queryString)for(_ref2=popupParcel.kiwi_servicesInfo,index=_j=0,_len1=_ref2.length;_len1>_j;index=++_j)serviceInfoObject=_ref2[index],null!=popupParcel.kiwi_customSearchResults.servicesSearched[serviceInfoObject.name]?(service_PreppedResults=popupParcel.kiwi_customSearchResults.servicesSearched[serviceInfoObject.name].results,resultsSummaryArray.push("<a class='jumpTo' data-serviceindex='"+index+"'>"+serviceInfoObject.title+" ("+service_PreppedResults.length+")</a>"),customSearchResultsHTML+=tailorResults[serviceInfoObject.name](serviceInfoObject,service_PreppedResults,popupParcel.kiwi_userPreferences),service_PreppedResults.length>14&&(customSearchResultsHTML+='<div class="listing showHidden" data-servicename="'+serviceInfoObject.name+'"> show remaining '+(service_PreppedResults.length-11)+" results</div>")):customSearchResultsHTML+="<br>No results for "+serviceInfoObject.title+"<br>";else customSearchResultsHTML+='<div id="customSearchResultsDrop"><br>No results to show... make a search! :) </div><br>';return customSearchResultsHTML="<div style='width: 100%; text-align: center;'>"+resultsSummaryArray.join(" - ")+"</div>"+customSearchResultsHTML,customSearchResultsHTML+="<br>",$(_this.DOMselector).html(openedCustomSearchHTML),$(_this.DOMselector+" #customSearchResults").html(customSearchResultsHTML),$(_this.DOMselector+" .hidden_listing").hide(),(duplicateFixedHeight=function(){var fixedElHeight,fixedElTableHeight;return fixedElHeight=$(_this.DOMselector+" .topSearchBar").outerHeight(),fixedElTableHeight=$(_this.DOMselector+" .topSearchBar table").outerHeight(),0===fixedElTableHeight?setTimeout(function(){return duplicateFixedHeight()},80):$(_this.DOMselector+" .notFixed").css({height:fixedElHeight+"px"})})()}}(this),bind:function(_this){return function(popupParcel){var closeWidget,customSearchQueryInput,customSearchQuerySubmit,customSearch_sortByPref,elsServicesActivePrefs,elsServicesButtons,jumpToServiceCustomResults,sendSearch,showHidden;return customSearchQueryInput=$(_this.DOMselector+" #customSearchQueryInput"),customSearchQuerySubmit=$(_this.DOMselector+" #customSearchQuerySubmit"),closeWidget=$(_this.DOMselector+" #close__"+_this.name),customSearch_sortByPref=$(_this.DOMselector+" .conversations_sortByPref"),elsServicesButtons=$(_this.DOMselector+" button.servicesToSearch "),elsServicesActivePrefs=$(_this.DOMselector+" .customSearchServicePref input"),showHidden=$(_this.DOMselector+" .showHidden"),jumpToServiceCustomResults=$("#customSearchResults .jumpTo"),_this.elsToUnbind=_this.elsToUnbind.concat(customSearchQueryInput,closeWidget,customSearchQuerySubmit,elsServicesButtons,customSearch_sortByPref,showHidden,jumpToServiceCustomResults),jumpToServiceCustomResults.bind("click",function(ev){var offsetBy,pxFromTop,serviceIndex;return serviceIndex=parseInt($(ev.target).data("serviceindex")),pxFromTop=$($("#customSearchResults .serviceResultsHeaderBar")[serviceIndex]).offset().top,offsetBy=$($("#customSearchResults .serviceResultsHeaderBar")[serviceIndex]).outerHeight()+40,$("body,html").scrollTop(pxFromTop-offsetBy)}),showHidden.bind("click",function(ev){var serviceName;return serviceName=$(ev.target).data("servicename"),$(_this.DOMselector+" .resultsBox__"+serviceName+" .hidden_listing").show(1200),$(ev.target).remove()}),elsServicesButtons.bind("click",function(ev){var ariaPressed,serviceName;return $(ev.target).hasClass("dropdownLabel")&&(serviceName=$(ev.target).attr("data-serviceName"),ariaPressed=$(ev.target).attr("aria-pressed"),"true"===ariaPressed?($("button.dropDownPrefs_"+serviceName).removeClass("active"),$(_this.DOMselector+" input.tagPref_"+serviceName).attr("disabled","disabled")):($("button.dropDownPrefs_"+serviceName).addClass("active"),$(_this.DOMselector+" input.tagPref_"+serviceName).removeAttr("disabled"))),$(ev.target).blur()}),customSearch_sortByPref.bind("change",function(ev){var parcel;return popupParcel.kiwi_userPreferences.sortByPref=$(ev.target).val(),parcel={refreshView:"conversations",keyName:"kiwi_userPreferences",newValue:popupParcel.kiwi_userPreferences,localOrSync:"sync",msg:"kiwiPP_post_save_a_la_carte"},sendParcel(parcel)}),sendSearch=function(){var el,elTagPref,elTagPrefs,elsServicesToSearch,parcel,queryString,serviceName,servicesToSearch,tagName,_i,_j,_len,_len1;for(queryString=customSearchQueryInput.val(),elsServicesToSearch=$(_this.DOMselector+' button.servicesToSearch[aria-pressed="true"]'),servicesToSearch={},_i=0,_len=elsServicesToSearch.length;_len>_i;_i++)for(el=elsServicesToSearch[_i],serviceName=$(el).attr("data-serviceName"),servicesToSearch[serviceName]={},servicesToSearch[serviceName].customSearchTags={},elTagPrefs=$(_this.DOMselector+" input.tagPref_"+serviceName+":checked"),_j=0,_len1=elTagPrefs.length;_len1>_j;_j++)elTagPref=elTagPrefs[_j],tagName=$(elTagPref).val(),servicesToSearch[serviceName].customSearchTags[tagName]={};return""!==queryString?(parcel={msg:"kiwiPP_post_customSearch",customSearchRequest:{queryString:queryString,servicesToSearch:servicesToSearch}},sendParcel(parcel)):void 0},customSearchQueryInput.keypress(function(event){var charCode;return charCode=event.keyCode?event.keyCode:event.which,13===charCode?sendSearch():void 0}),customSearchQuerySubmit.bind("click",function(){return sendSearch()}),closeWidget.bind("click",function(){return _this.widgetOpenBool=!1,_this.render("collapsed",popupParcel)}),customSearchQueryInput.focus()}}(this)}}},CustomSearch}(Widget),View=function(){function View(_at_name,_at___renderStates__){return this.name=_at_name,this.__renderStates__=_at___renderStates__,this.render=__bind(this.render,this),this.elsToUnbind=[],this.totalRenders=0,this.DOMselector="#"+this.name+"_View",this.Widgets={},this.bindAllGoToViewButtons=function(_this){return function(viewData){var els_goTo_view,viewValue,_results,_viewName;_results=[];for(_viewName in switchViews)viewValue=switchViews[_viewName],els_goTo_view=$(_this.DOMselector+" .goTo_"+_viewName+"View"),_this.elsToUnbind.push(els_goTo_view),_results.push(bindGoToViewButtons(els_goTo_view,_viewName,viewData));return _results}}(this),this.unbindView=function(_this){return function(){var el,widget,_i,_j,_len,_len1,_ref,_ref1,_results;for(_ref=_this.elsToUnbind,_i=0,_len=_ref.length;_len>_i;_i++)el=_ref[_i],el.unbind();for(_this.elsToUnbind=[],_ref1=_this.Widgets,_results=[],_j=0,_len1=_ref1.length;_len1>_j;_j++)widget=_ref1[_j],_results.push(widget.unbindWidget());return _results}}(this),this.renderStates=this.__renderStates__(),this}return View.prototype.render=function(popupParcel,renderState){return null==renderState&&(renderState="__normal__"),this.unbindView(this.name),this.totalRenders++,null==renderState&&null==this.renderStates.__normal__&&console.log("popup::ERROR: must declare renderState for view "+this.name+" since __normal__ undefined"),this.renderStates[renderState].paint(popupParcel),this.bindAllGoToViewButtons(popupParcel),this.renderStates[renderState].bind(popupParcel)},View}(),FixedView=function(_super){function FixedView(_at_name,_at___renderStates__,uniqueSelectorPostfix){this.name=_at_name,this.__renderStates__=_at___renderStates__,FixedView.__super__.constructor.call(this,this.name,this.__renderStates__),this.DOMselector+=uniqueSelectorPostfix}return __extends(FixedView,_super),FixedView}(View),SwitchView=function(_super){function SwitchView(_at_name,_at___renderStates__){this.name=_at_name,this.__renderStates__=_at___renderStates__,this.render=__bind(this.render,this),this.showView=__bind(this.showView,this),SwitchView.__super__.constructor.call(this,this.name,this.__renderStates__)}return __extends(SwitchView,_super),SwitchView.prototype.showView=function(){var viewValue,_results,_viewName;_results=[];for(_viewName in switchViews)viewValue=switchViews[_viewName],_results.push(_viewName===this.name?$("#"+_viewName+"_View").css({display:"block"}):$("#"+_viewName+"_View").css({display:"none"}));return _results},SwitchView.prototype.render=function(popupParcel,renderState){return null==renderState&&(renderState="__normal__"),SwitchView.__super__.render.call(this,popupParcel,renderState),this.showView()},SwitchView}(View),Conversations=function(_super){function Conversations(_at_name){this.name=_at_name,this.__renderStates__=__bind(this.__renderStates__,this),Conversations.__super__.constructor.call(this,this.name,this.__renderStates__),this.Widgets={customSearch:new CustomSearch("customSearch",this,!1)}}return __extends(Conversations,_super),Conversations.prototype.init=function(popupParcel){return this.unbindWidget(),this.render(popupParcel)},Conversations.prototype.__renderStates__=function(){return{__normal__:{paint:function(_this){return function(popupParcel){var index,preppedHTMLstring,researchModeDisabledButtonsHTML,resultsHTML,resultsSummaryArray,serviceInfoObject,service_PreppedResults,submitTitle,submitUrl,totalResults,_i,_len,_ref;for(_this.Widgets.customSearch.init(popupParcel),researchModeDisabledButtonsHTML="",(popupParcel.urlBlocked===!0||"off"===popupParcel.kiwi_userPreferences.researchModeOnOff||null!=popupParcel.oldUrl&&popupParcel.oldUrl===!0)&&(researchModeDisabledButtonsHTML+="<br> <div style='width:100%;text-align: center;'><button class='btn btn-success' style='font-size: 1.1em;display: inline-block;' id='researchUrlOverride'>Research this Url</button></div> <br>"),"off"===popupParcel.kiwi_userPreferences.researchModeOnOff&&(researchModeDisabledButtonsHTML+="<br>Research Mode is off <button class='goTo_userPreferencesView btn btn-mini btn-default'> change settings </button><br>"),$("#researchModeDisabledButtons").html(researchModeDisabledButtonsHTML),preppedHTMLstring='<h3 style="position:relative; top:-10px;">Results for this URL:</h3>',resultsSummaryArray=[],totalResults=0,resultsHTML="",_ref=popupParcel.kiwi_servicesInfo,index=_i=0,_len=_ref.length;_len>_i;index=++_i)serviceInfoObject=_ref[index],null!=popupParcel.allPreppedResults[serviceInfoObject.name]&&popupParcel.allPreppedResults[serviceInfoObject.name].service_PreppedResults.length>0?(service_PreppedResults=popupParcel.allPreppedResults[serviceInfoObject.name].service_PreppedResults,resultsSummaryArray.push("<a class='jumpTo' data-serviceindex='"+index+"'>"+serviceInfoObject.title+" ("+service_PreppedResults.length+")</a>"),totalResults+=service_PreppedResults.length,resultsHTML+=tailorResults[serviceInfoObject.name](serviceInfoObject,service_PreppedResults,popupParcel.kiwi_userPreferences),service_PreppedResults.length>14&&(resultsHTML+='<div class="listing showHidden" data-servicename="'+serviceInfoObject.name+'"> show remaining '+(service_PreppedResults.length-11)+" results</div>")):null!=serviceInfoObject.submitTitle?(submitUrl=serviceInfoObject.submitUrl,submitTitle=serviceInfoObject.submitTitle,resultsHTML+="<div>No matches for conversations on "+serviceInfoObject.title+'... <br> &nbsp;&nbsp;&nbsp;<a target="_blank" href="'+submitUrl+'">'+submitTitle+"</a></div><br>"):resultsHTML+="<div>No results for "+serviceInfoObject.title+"</div>";return 4>totalResults&&_this.totalRenders<3&&fixedViews.kiwiSlice.render(popupParcel,"open"),preppedHTMLstring+="<div style='width: 100%; text-align: center;'>"+resultsSummaryArray.join(" - ")+"</div><br>",preppedHTMLstring+=resultsHTML,$("#resultsByService").html(preppedHTMLstring),$(_this.DOMselector+" .hidden_listing").hide(),setTimeout(function(){return $($("input")[0]).blur(),$($("a")[0]).blur(),$($("button")[0]).blur()},300),$($("input")[0]).blur(),$($("a")[0]).blur(),$($("button")[0]).blur()}}(this),bind:function(_this){return function(popupParcel){var conversations_sortByPref,customSearchOpen,jumpToService,researchUrlOverrideButton,showHidden;return showHidden=$(_this.DOMselector+" .showHidden"),researchUrlOverrideButton=$(_this.DOMselector+" #researchUrlOverride"),conversations_sortByPref=$(_this.DOMselector+" .conversations_sortByPref"),customSearchOpen=$(_this.DOMselector+" .customSearchOpen"),jumpToService=$("#resultsByService .jumpTo"),_this.elsToUnbind=_this.elsToUnbind.concat(conversations_sortByPref,showHidden,researchUrlOverrideButton,customSearchOpen,jumpToService),jumpToService.bind("click",function(ev){var offsetBy,pxFromTop,serviceIndex;return serviceIndex=parseInt($(ev.target).data("serviceindex")),pxFromTop=$($("#resultsByService .serviceResultsHeaderBar")[serviceIndex]).offset().top,offsetBy=$($("#resultsByService .serviceResultsHeaderBar")[serviceIndex]).outerHeight()+40,$("body,html").scrollTop(pxFromTop-offsetBy)}),customSearchOpen.bind("click",function(){return $("#customSearchQueryInput").click()}),researchUrlOverrideButton.bind("click",function(){var parcel;return parcel={msg:"kiwiPP_researchUrlOverrideButton"},sendParcel(parcel)}),showHidden.bind("click",function(ev){var serviceName;return serviceName=$(ev.target).data("servicename"),$(_this.DOMselector+" .resultsBox__"+serviceName+" .hidden_listing").show(1200),$(ev.target).remove()}),conversations_sortByPref.bind("change",function(ev){var parcel;return popupParcel.kiwi_userPreferences.sortByPref=$(ev.target).val(),parcel={refreshView:"conversations",keyName:"kiwi_userPreferences",newValue:popupParcel.kiwi_userPreferences,localOrSync:"sync",msg:"kiwiPP_post_save_a_la_carte"},sendParcel(parcel)})}}(this)}}},Conversations}(SwitchView),UserPreferences=function(_super){function UserPreferences(_at_name){this.name=_at_name,this.__renderStates__=__bind(this.__renderStates__,this),UserPreferences.__super__.constructor.call(this,this.name,this.__renderStates__)}return __extends(UserPreferences,_super),UserPreferences.prototype.init=function(popupParcel){return this.unbindWidget(),this.render(popupParcel)},UserPreferences.prototype.__renderStates__=function(){return{__normal__:{paint:function(_this){return function(popupParcel){var activeCheck,autoOffTimerType,autoOffTimerValue,currentTime,index,notActiveCheck,researchModeExpirationString,researchModeHtml,researchOffString,researchOnString,service,servicesHtml,_i,_len,_ref;$(_this.DOMselector+" .userErrMsg").html(""),preferencesOnlyPage===!0&&$("#menuBar_preferences").hide(),currentTime=Date.now(),$("#autoOffTimer").html("off"===popupParcel.kiwi_userPreferences.researchModeOnOff?"Research mode is off, so auto-off timer is not set":null!=popupParcel.kiwi_userPreferences.autoOffAtUTCmilliTimestamp&&popupParcel.kiwi_userPreferences.autoOffAtUTCmilliTimestamp>currentTime?"Auto-Off timer expires at: "+formatTime(popupParcel.kiwi_userPreferences.autoOffAtUTCmilliTimestamp)+"<br>":"off"===popupParcel.kiwi_userPreferences.researchModeOnOff&&null!=popupParcel.kiwi_userPreferences.autoOffAtUTCmilliTimestamp?"Auto-off timer last expired at: "+formatTime(popupParcel.kiwi_userPreferences.autoOffAtUTCmilliTimestamp)+"<br>":"Auto-off timer is not set"),researchModeHtml="","on"===popupParcel.kiwi_userPreferences.researchModeOnOff?(researchOnString=" checked='checked' ",researchOffString=""):(researchOnString="",researchOffString=" checked='checked' "),"undefined"!=typeof autoOffAtUTCmilliTimestamp&&null!==autoOffAtUTCmilliTimestamp?(researchModeExpirationString="<br>Research Mode will turn off (expire) at: "+formatTime(autoOffAtUTCmilliTimestamp),researchModeExpirationString+='<br><button class="btn btn-mini btn-default" id="resetAutoOffTimer">Reset auto-off timer</button>'):researchModeExpirationString="",autoOffTimerType=popupParcel.kiwi_userPreferences.autoOffTimerType,autoOffTimerValue=popupParcel.kiwi_userPreferences.autoOffTimerValue;var auto20,auto60,autoAlways,autoCustom,autoCustomValue="";for(null!=autoOffTimerType&&("20"==autoOffTimerType?auto20=" checked='checked' ":"60"==autoOffTimerType?auto60=" checked='checked' ":"always"==autoOffTimerType?autoAlways=" checked='checked' ":"custom"==autoOffTimerType&&(autoCustom=" checked='checked' ",autoCustomValue=autoOffTimerValue)),researchModeHtml+='Research Mode: on <input type="radio" name="research" value="on" '+researchOnString+'> - off <input type="radio" name="research" value="off" '+researchOffString+">"+researchModeExpirationString+'<br> <br>Auto-Off in: <br>&nbsp; &nbsp;<label><input type="radio" name="researchAutoOffType" '+auto20+' value="20"> 20 min</label> <br>&nbsp; &nbsp;<label><input type="radio" name="researchAutoOffType" '+auto60+' value="60"> 1 hr</label> <br>&nbsp; &nbsp;<label><input type="radio" name="researchAutoOffType" '+autoAlways+' value="always"> Always On</label> <br>&nbsp; &nbsp;<label><input type="radio" name="researchAutoOffType" '+autoCustom+' value="custom"> Custom</label> &nbsp; &nbsp; <input id="autoCustomValue" type="text" value="'+autoCustomValue+'" size="4" disabled /> minutes',$("#researchModeDrop").html(researchModeHtml),servicesHtml="",_ref=popupParcel.kiwi_servicesInfo,index=_i=0,_len=_ref.length;_len>_i;index=++_i)service=_ref[index],"on"===service.active?(activeCheck=" checked='checked' ",notActiveCheck=""):(activeCheck="",notActiveCheck=" checked='checked' "),servicesHtml+='<br> <div class="serviceListing listing"> <table><tbody><tr> <td class="upDownButtons">',0!==index&&(servicesHtml+='<span class="glyphicon glyphicon-chevron-up" id="'+service.name+'_moveServiceUp" aria-hidden="true"></span>'),0!==index&&index!==popupParcel.kiwi_servicesInfo.length-1&&(servicesHtml+="<br><br>"),index!==popupParcel.kiwi_servicesInfo.length-1&&(servicesHtml+='<span class="glyphicon glyphicon-chevron-down" id="'+service.name+'_moveServiceDown" aria-hidden="true"></span>'),servicesHtml+='</td> <td class="serviceInfo">'+service.title+' - using: <a href="'+service.broughtToYouByURL+'">'+service.broughtToYouByTitle+'</a><br> <div style="padding-left:15px;"> status: on <input type="radio" name="'+service.name+'_serviceStatus" value="on" '+activeCheck+'> - off <input type="radio" name="'+service.name+'_serviceStatus" value="off" '+notActiveCheck+"> <br><br>Results are deemed notable (capitilizes badge letter) if:",servicesHtml+='<br> URL is an exact match, and: <br> it has been <input id="'+service.name+'_hoursNotable" type="text" size="4" value="'+service.notableConditions.hoursSincePosted+'"/> or fewer hours since posting <br> <div style="width:100%; text-align:center;"><span style="padding:7px; margin-right: 280px; display: inline-block;"> - or - </span></div> a post has <input id="'+service.name+'_commentsNotable" type="text" size="4" value="'+service.notableConditions.num_comments+'"/> or more comments </div> </td> </tr></tbody></table> </div>';return servicesHtml+="<div class='serviceListing listing' style='padding:15px; margin-top: 30px;'> Wouldn't it be awesome if we could add some more services to opt-in to?&nbsp;&nbsp; All that's needed are friendly APIs!&nbsp; <a href='https://twitter.com/spencenow' target='_blank'>Tweet me</a> if you're interested in adding one! </div>",$("#servicesInfoDrop").html(servicesHtml)}}(this),bind:function(_this){return function(popupParcel){var allInputs,autoTimerRadios,downButton,index,postError,saveButtons,service,upButton,_bindDown,_bindUp,_i,_len,_ref;for(saveButtons=$(_this.DOMselector+" .userPreferencesSave"),saveButtons.attr("disabled","disabled"),autoTimerRadios=$(_this.DOMselector+" input:radio[name='researchAutoOffType']"),allInputs=$(_this.DOMselector+" input"),_this.elsToUnbind=_this.elsToUnbind.concat(allInputs,saveButtons,autoTimerRadios),allInputs.bind("change",function(){return $(".userPreferencesSave").removeAttr("disabled")}),allInputs.bind("focus",function(){return $(".userPreferencesSave").removeAttr("disabled")}),"custom"===$("input:radio[name='researchAutoOffType']:checked").val()&&$("#autoCustomValue").removeAttr("disabled"),autoTimerRadios.bind("change",function(){return"custom"===$("input:radio[name='researchAutoOffType']:checked").val()?$("#autoCustomValue").removeAttr("disabled"):$("#autoCustomValue").attr("disabled","disabled")}),_bindDown=function(downButton,index){return downButton.bind("click",function(){var parcel;return popupParcel.kiwi_servicesInfo=moveArrayElement(popupParcel.kiwi_servicesInfo,index,index+1),parcel={refreshView:"userPreferences",keyName:"kiwi_servicesInfo",newValue:popupParcel.kiwi_servicesInfo,localOrSync:"sync",msg:"kiwiPP_post_save_a_la_carte"},sendParcel(parcel)})},_bindUp=function(upButton,index){return upButton.bind("click",function(){var parcel;return popupParcel.kiwi_servicesInfo=moveArrayElement(popupParcel.kiwi_servicesInfo,index,index-1),parcel={refreshView:"userPreferences",keyName:"kiwi_servicesInfo",newValue:popupParcel.kiwi_servicesInfo,localOrSync:"sync",msg:"kiwiPP_post_save_a_la_carte"},sendParcel(parcel)})},_ref=popupParcel.kiwi_servicesInfo,index=_i=0,_len=_ref.length;_len>_i;index=++_i)service=_ref[index],downButton=$("#"+service.name+"_moveServiceDown"),downButton.length>0&&(_this.elsToUnbind.push(downButton),_bindDown(downButton,index)),upButton=$("#"+service.name+"_moveServiceUp"),upButton.length>0&&(_this.elsToUnbind.push(upButton),_bindUp(upButton,index));return postError=function(userErrMsg){return $(_this.DOMselector+" .userErrMsg").html("<br>"+userErrMsg)},saveButtons.bind("click",function(){var active,allowedAutoOffTypes,autoOffTimerType,autoOffTimerValue,hoursSincePosted,num_comments,numberOfRelatedItemsWithClusterURL,numberOfStoriesFoundWithinTheHoursSincePostedLimit,parcel,researchModeHTMLval,_j,_k,_len1,_len2,_ref1,_ref2;if(researchModeHTMLval=$("input:radio[name='research']:checked").val(),"on"!==researchModeHTMLval&&"off"!==researchModeHTMLval)return postError('research mode must be "on" or "off"'),0;if(allowedAutoOffTypes=["20","60","always","custom"],autoOffTimerType=$("input:radio[name='researchAutoOffType']:checked").val(),autoOffTimerValue=$("#autoCustomValue").val(),!(__indexOf.call(allowedAutoOffTypes,autoOffTimerType)>=0))return postError("not acceptable autoOffTimerType"),0;if("custom"===autoOffTimerType&&(""===autoOffTimerValue||isNaN(autoOffTimerValue)))return postError("Must specify a number of minutes for auto-off timer."),0;for(_ref1=popupParcel.kiwi_servicesInfo,index=_j=0,_len1=_ref1.length;_len1>_j;index=++_j)if(service=_ref1[index],"gnews"===service.name){if(active=$("input:radio[name='"+service.name+"_serviceStatus']:checked").val(),"on"!==active&&"off"!==active)return postError('active must be "on" or "off"'),0;if(numberOfStoriesFoundWithinTheHoursSincePostedLimit=$("#"+service.name+"_numberOfStoriesFoundWithinTheHoursSincePostedLimit").val(),""===numberOfStoriesFoundWithinTheHoursSincePostedLimit||isNaN(numberOfStoriesFoundWithinTheHoursSincePostedLimit))return postError("number Of Stories Found Within The Hours Since Posted Limit must be an integer"),0;if(numberOfRelatedItemsWithClusterURL=$("#"+service.name+"_numberOfRelatedItemsWithClusterURL").val(),""===numberOfRelatedItemsWithClusterURL||isNaN(numberOfRelatedItemsWithClusterURL))return postError("number Of Related Items With Cluster URL of comments must be an integer"),
0}else{if(active=$("input:radio[name='"+service.name+"_serviceStatus']:checked").val(),"on"!==active&&"off"!==active)return postError('active must be "on" or "off"'),0;if(hoursSincePosted=$("#"+service.name+"_hoursNotable").val(),""===hoursSincePosted||isNaN(hoursSincePosted))return postError("Hours must be an number"),0;if(num_comments=$("#"+service.name+"_commentsNotable").val(),""===num_comments||isNaN(num_comments))return postError("Number of comments must be an integer"),0}for(popupParcel.kiwi_userPreferences.researchModeOnOff=researchModeHTMLval,"custom"!==autoOffTimerType?popupParcel.kiwi_userPreferences.autoOffTimerType=autoOffTimerType:(popupParcel.kiwi_userPreferences.autoOffTimerType=autoOffTimerType,popupParcel.kiwi_userPreferences.autoOffTimerValue=parseFloat(autoOffTimerValue)),_ref2=popupParcel.kiwi_servicesInfo,index=_k=0,_len2=_ref2.length;_len2>_k;index=++_k)service=_ref2[index],active=$("input:radio[name='"+service.name+"_serviceStatus']:checked").val(),popupParcel.kiwi_servicesInfo[index].active=active,hoursSincePosted=$("#"+service.name+"_hoursNotable").val(),popupParcel.kiwi_servicesInfo[index].notableConditions.hoursSincePosted=parseFloat(hoursSincePosted),"gnews"===service.name?(numberOfRelatedItemsWithClusterURL=$("#"+service.name+"_numberOfRelatedItemsWithClusterURL").val(),popupParcel.kiwi_servicesInfo[index].notableConditions.numberOfRelatedItemsWithClusterURL=parseInt(numberOfRelatedItemsWithClusterURL),numberOfStoriesFoundWithinTheHoursSincePostedLimit=$("#"+service.name+"_numberOfStoriesFoundWithinTheHoursSincePostedLimit").val(),popupParcel.kiwi_servicesInfo[index].notableConditions.numberOfStoriesFoundWithinTheHoursSincePostedLimit=parseInt(numberOfStoriesFoundWithinTheHoursSincePostedLimit)):(num_comments=$("#"+service.name+"_commentsNotable").val(),popupParcel.kiwi_servicesInfo[index].notableConditions.num_comments=parseInt(num_comments));return popupParcel.view="userPreferences",parcel={refreshView:popupParcel.view,newPopupParcel:popupParcel,msg:"kiwiPP_post_savePopupParcel"},sendParcel(parcel)})}}(this)}}},UserPreferences}(SwitchView),Credits=function(_super){function Credits(_at_name){this.name=_at_name,this.__renderStates__=__bind(this.__renderStates__,this),Credits.__super__.constructor.call(this,this.name,this.__renderStates__)}return __extends(Credits,_super),Credits.prototype.init=function(popupParcel){return this.unbindWidget(),this.render(popupParcel)},Credits.prototype.__renderStates__=function(){return{__normal__:{paint:function(_this){return function(popupParcel){}}(this),bind:function(_this){return function(popupParcel){}}(this)}}},Credits}(SwitchView),Loading=function(_super){function Loading(_at_name){this.name=_at_name,this.__renderStates__=__bind(this.__renderStates__,this),Loading.__super__.constructor.call(this,this.name,this.__renderStates__)}return __extends(Loading,_super),Loading.prototype.init=function(popupParcel){return this.unbindWidget(),this.render(popupParcel)},Loading.prototype.__renderStates__=function(){return{__normal__:{paint:function(_this){return function(popupParcel){}}(this),bind:function(_this){return function(popupParcel){}}(this)}}},Loading}(SwitchView),KiwiSlice=function(_super){function KiwiSlice(_at_name,uniqueSelectorPostfix){this.name=_at_name,this.__renderStateTransitions__=__bind(this.__renderStateTransitions__,this),this.__renderStates__=__bind(this.__renderStates__,this),this.render=__bind(this.render,this),this.init=__bind(this.init,this),KiwiSlice.__super__.constructor.call(this,this.name,this.__renderStates__,uniqueSelectorPostfix)}return __extends(KiwiSlice,_super),KiwiSlice.prototype.init=function(popupParcel,renderState){return null==renderState&&(renderState=null),this.renderStateTransitions=this.__renderStateTransitions__(),this.unbindView(),renderState=null!=renderState?renderstate:"collapsed",this.render(popupParcel,"collapsed")},KiwiSlice.prototype.render=function(popupParcel,renderState,fromState){var __renderStates__callback;return null==fromState&&(fromState=null),__renderStates__callback=function(_this){return function(popupParcel,renderState){return KiwiSlice.__super__.render.call(_this,popupParcel,renderState)}}(this),null!=fromState&&null!=this.renderStateTransitions[fromState+"__to__"+renderState]?this.renderStateTransitions[fromState+"__to__"+renderState](popupParcel,renderState,__renderStates__callback):KiwiSlice.__super__.render.call(this,popupParcel,renderState)},KiwiSlice.prototype.__renderStates__=function(){return{collapsed:{paint:function(_this){return function(popupParcel){var kiwiSliceHTML;return kiwiSliceHTML='<div id="sliceActivateTransition" style="position:fixed; bottom: -33px; right: -33px; "> <img style="width: 66px; height: 66px;" src="./symmetricKiwi.png" /> </div>',$(_this.DOMselector).html(kiwiSliceHTML)}}(this),bind:function(_this){return function(popupParcel){var elActivateTransition;return elActivateTransition=$(_this.DOMselector+" #sliceActivateTransition"),_this.elsToUnbind=_this.elsToUnbind.concat(elActivateTransition),elActivateTransition.bind("mouseover",function(ev){return elActivateTransition.addClass("rotateClockwiseFull")}),elActivateTransition.bind("mouseout",function(ev){return elActivateTransition.removeClass("rotateClockwiseFull")}),elActivateTransition.bind("click",function(ev){return elActivateTransition.removeClass("rotateClockwiseFull"),_this.render(popupParcel,"open","collapsed")})}}(this)},open:{paint:function(_this){return function(popupParcel){var kiwiSliceHTML;return kiwiSliceHTML='<div id="transition_open_showMe" class="evenlySpacedContainer kiwiSliceOpenPlatter"> <button type="button" class=" goTo_creditsView btn btn-mini btn-default">credits</button> <a class=" btn btn-mini btn-default" style="font-size:.8em;" target="_blank" href="http://www.metafruit.com/kiwi/">MetaFruit <span class="glyphicon glyphicon-apple"></span></a> <button class=" btn btn-mini btn-default" id="clearKiwiURLCache">clear cache</button> <button class=" btn btn-mini btn-default" id="refreshURLresults">refresh</button> </div> <div id="sliceActivateTransition" style="position:fixed; bottom: 15px; right: 15px; "> <img style="width: 66px; height: 66px;" src="symmetricKiwi.png" /> </div>',$(_this.DOMselector).html(kiwiSliceHTML)}}(this),bind:function(_this){return function(popupParcel){var clearKiwiURLCacheButton,elActivateTransition,refreshURLresultsButton;return elActivateTransition=$(_this.DOMselector+" #sliceActivateTransition"),clearKiwiURLCacheButton=$(_this.DOMselector+" #clearKiwiURLCache"),refreshURLresultsButton=$(_this.DOMselector+" #refreshURLresults"),_this.elsToUnbind=_this.elsToUnbind.concat(elActivateTransition,refreshURLresultsButton,clearKiwiURLCacheButton),refreshURLresultsButton.bind("click",function(){var parcel;return parcel={msg:"kiwiPP_refreshURLresults"},sendParcel(parcel)}),$("body").mouseup(function(e){var container;return container=$(_this.DOMselector),container.is(e.target)||0!==container.has(e.target).length?void 0:($("body").unbind("mouseup"),_this.render(popupParcel,"collapsed","open"))}),elActivateTransition.bind("click",function(ev){return _this.render(popupParcel,"collapsed","open")}),clearKiwiURLCacheButton.bind("click",function(){var parcel;return parcel={msg:"kiwiPP_clearAllURLresults"},sendParcel(parcel)})}}(this)}}},KiwiSlice.prototype.__renderStateTransitions__=function(){return{open__to__collapsed:function(_this){return function(popupParcel,renderState,__renderStates__callback){return $(_this.DOMselector+" #transition_open_showMe").animate({opacity:0},300),$(_this.DOMselector+" #sliceActivateTransition").addClass("rotateClockwise"),$(_this.DOMselector+" #sliceActivateTransition").animate({bottom:"-33px",right:"-33px"},{duration:500,complete:function(){return __renderStates__callback(popupParcel,renderState)}})}}(this),collapsed__to__open:function(_this){return function(popupParcel,renderState,__renderStates__callback){return $(_this.DOMselector+" #sliceActivateTransition").addClass("rotateCounterClockwise"),$(_this.DOMselector+" #sliceActivateTransition").animate({bottom:"15px",right:"15px"},{duration:500,complete:function(){return __renderStates__callback(popupParcel,renderState)}}),$(_this.DOMselector).prepend('<div id="transition_open_showMe" class="evenlySpacedContainer kiwiSliceOpenPlatter" style="opacity: 0;"> <button type="button" class="goTo_creditsView btn btn-mini btn-default ">credits</button> <a class=" btn btn-mini btn-default" style="font-size:.8em;" target="_blank" href="http://www.metafruit.com/kiwi/">MetaFruit <span class="glyphicon glyphicon-apple"></span></a> <button class="btn btn-mini btn-default " id="clearKiwiURLCache">clear cache</button> <button class="btn btn-mini btn-default " id="refreshURLresults">refresh</button> </div>'),$(_this.DOMselector+" #transition_open_showMe").animate({opacity:1},499)}}(this)}},KiwiSlice}(FixedView),fixedViews={kiwiSlice:new KiwiSlice("kiwiSlice","FixedBottom")},switchViews={conversations:new Conversations("conversations"),userPreferences:new UserPreferences("userPreferences"),credits:new Credits("credits"),loading:new Loading("loading")},tailorResults={gnews:function(serviceInfoObject,service_PreppedResults,kiwi_userPreferences){var currentTime,index,listing,listingClass,preppedHTMLstring,recentTag,selectedString_attention,selectedString_recency,_i,_len,_time;for(currentTime=Date.now(),preppedHTMLstring="<div class='serviceResultsBox resultsBox__"+serviceInfoObject.name+"'> <div class='serviceResultsHeaderBar'> <span class='serviceResultsTitles'>"+serviceInfoObject.title+'</span> &nbsp;&nbsp;<a class="customSearchOpen"> modify search</a>',"attention"===kiwi_userPreferences.sortByPref?(selectedString_attention="selected",selectedString_recency=""):(selectedString_attention="",selectedString_recency="selected"),preppedHTMLstring+='<div style="float:right; padding-top: 9px;">&nbsp;&nbsp; sorted by: <select class="conversations_sortByPref"> <option '+selectedString_attention+' id="_attention" value="attention">attention</option> <option '+selectedString_recency+' id="_recency" value="recency">recency</option> </select> </div> </div>',null!=service_PreppedResults&&service_PreppedResults.length>0&&(preppedHTMLstring+='Searched for: "<strong>'+service_PreppedResults[0].kiwi_searchedFor+'</strong>"<br>'),"attention"===kiwi_userPreferences.sortByPref?(service_PreppedResults=_.sortBy(service_PreppedResults,"clusterUrl"),service_PreppedResults.reverse()):"recency"===kiwi_userPreferences.sortByPref&&(service_PreppedResults=_.sortBy(service_PreppedResults,"kiwi_created_at"),service_PreppedResults.reverse()),index=_i=0,_len=service_PreppedResults.length;_len>_i;index=++_i)listing=service_PreppedResults[index],listingClass=index>10&&service_PreppedResults.length>14?" hidden_listing":"",recentTag=currentTime-listing.kiwi_created_at<144e5?"<span class='recentListingTag'>Recent: </span>":"",preppedHTMLstring+='<div class="listing '+listingClass+'" style="position:relative;">'+recentTag+'<a class="listingTitle" target="_blank" href="'+listing.unescapedUrl+'">'+listing.titleNoFormatting+"<br>",_time=formatTime(listing.kiwi_created_at),preppedHTMLstring+=listing.publisher+" -- "+_time+"</a> <br>"+listing.content+"<br>",""!==listing.clusterUrl&&(preppedHTMLstring+='<a target="_blank" href="'+listing.clusterUrl+'"> Google News cluster </a>'),preppedHTMLstring+="</a> </div>";return preppedHTMLstring+="</div>"},hackerNews:function(serviceInfoObject,service_PreppedResults,kiwi_userPreferences){return tailorRedditAndHNresults_returnHtml(serviceInfoObject,service_PreppedResults,kiwi_userPreferences)},reddit:function(serviceInfoObject,service_PreppedResults,kiwi_userPreferences){return tailorRedditAndHNresults_returnHtml(serviceInfoObject,service_PreppedResults,kiwi_userPreferences)}},_tailorHNcomment=function(listing,serviceInfoObject,listingClass){var commentHtml,currentTime,recentTag,_time;return currentTime=Date.now(),commentHtml="",recentTag=currentTime-listing.kiwi_created_at<144e5?"<span class='recentListingTag'>Recent: </span>":"",commentHtml+='<div class="listing '+listingClass+' " style="position:relative;">'+recentTag,commentHtml+=null!=listing.over_18&&listing.over_18===!0?'<span class="nsfw">NSFW</span>For story: '+listing.story_title+"<br>":"For story: <a target='_blank' href='"+serviceInfoObject.permalinkBase+listing.story_id+"'>"+listing.story_title+"</a><br>",_time=formatTime(listing.kiwi_created_at),commentHtml+="at "+_time+', <a target="_blank" href="'+serviceInfoObject.userPageBaselink+listing.author+'">'+listing.author+"</a> recieved "+listing.kiwi_score+' upvotes, by saying: ( <a class="listingTitle" target="_blank" href="'+serviceInfoObject.permalinkBase+listing.kiwi_permaId+'"> comment permalink </a> , <a class="listingTitle" target="_blank" href="'+serviceInfoObject.permalinkBase+listing.story_id+'"> story permalink </a> )<br><div class="commentBox">'+listing.comment_text+"</div></div>"},tailorRedditAndHNresults_returnHtml=function(serviceInfoObject,service_PreppedResults,kiwi_userPreferences){var currentTime,fuzzyMatchBool,index,listing,listingClass,numberOfExactMatches,preppedHTMLstring,recentTag,selectedString_attention,selectedString_recency,_i,_j,_len,_len1,_time;if(preppedHTMLstring="",currentTime=Date.now(),fuzzyMatchBool=!1,preppedHTMLstring+="<div class='serviceResultsBox resultsBox__"+serviceInfoObject.name+"'> <div class='serviceResultsHeaderBar'> <span class='serviceResultsTitles'>"+serviceInfoObject.title+"</span>","attention"===kiwi_userPreferences.sortByPref?(selectedString_attention="selected",selectedString_recency=""):(selectedString_attention="",selectedString_recency="selected"),preppedHTMLstring+='<div style="float:right; padding-top:9px;"> &nbsp;&nbsp sorted by: <select class="conversations_sortByPref"> <option '+selectedString_attention+' id="_attention" value="attention">attention</option> <option '+selectedString_recency+' id="_recency" value="recency">recency</option> </select></div> </div>',service_PreppedResults.length<1)return preppedHTMLstring+=" no results <br>";for(null==service_PreppedResults[0].comment_text&&"attention"===kiwi_userPreferences.sortByPref?(service_PreppedResults=_.sortBy(service_PreppedResults,"num_comments"),service_PreppedResults.reverse()):"attention"===kiwi_userPreferences.sortByPref?(service_PreppedResults=_.sortBy(service_PreppedResults,"kiwi_score"),service_PreppedResults.reverse()):"recency"===kiwi_userPreferences.sortByPref&&(service_PreppedResults=_.sortBy(service_PreppedResults,"kiwi_created_at"),service_PreppedResults.reverse()),index=_i=0,_len=service_PreppedResults.length;_len>_i;index=++_i)listing=service_PreppedResults[index],listingClass=index>10&&service_PreppedResults.length>14?" hidden_listing ":"",null!=listing.comment_text?preppedHTMLstring+=_tailorHNcomment(listing,serviceInfoObject,listingClass):(recentTag=currentTime-listing.kiwi_created_at<144e5?"<span class='recentListingTag'>Recent: </span>":"",listing.kiwi_exact_match?(preppedHTMLstring+='<div class="listing '+listingClass+'">',"reddit"!==serviceInfoObject.name&&(preppedHTMLstring+='<div style="float:right;"> <a target="_blank" href="'+serviceInfoObject.userPageBaselink+listing.author+'"> by '+listing.author+"</a> </div>"),preppedHTMLstring+='<a class="listingTitle" target="_blank" href="'+serviceInfoObject.permalinkBase+listing.kiwi_permaId+'"><span style="color:black;">'+recentTag,preppedHTMLstring+=null!=listing.over_18&&listing.over_18===!0?'<span class="nsfw">NSFW</span>'+listing.title+"<br>":listing.title+"<br>",_time=formatTime(listing.kiwi_created_at),preppedHTMLstring+=listing.num_comments+" comments, "+listing.kiwi_score+" upvotes -- "+_time+"</span></a>",null!=listing.subreddit&&(preppedHTMLstring+='<br><span> <a target="_blank" href="'+serviceInfoObject.permalinkBase+"/r/"+listing.subreddit+'"> subreddit: '+listing.subreddit+'</a></span> <div style="float:right;"> <a target="_blank" href="'+serviceInfoObject.userPageBaselink+listing.author+'"> by '+listing.author+"</a> </div>"),preppedHTMLstring+="<br><br></div>"):fuzzyMatchBool=!0);if(fuzzyMatchBool){for(numberOfExactMatches=_.reduce(service_PreppedResults,function(memo,obj){return obj.kiwi_exact_match?(memo++,memo):memo}),listingClass=service_PreppedResults.length-numberOfExactMatches>10&&service_PreppedResults.length>14?" hidden_listing ":"",preppedHTMLstring+='<div class="showFuzzyMatches '+listingClass+'" style="position:relative;"> fuzzy matches: <br></div> <span class="fuzzyMatches">',index=_j=0,_len1=service_PreppedResults.length;_len1>_j;index=++_j)listing=service_PreppedResults[index],listingClass=index>10&&service_PreppedResults.length>14?" hidden_listing ":"",listing.kiwi_exact_match||(recentTag=currentTime-listing.kiwi_created_at<144e5?"<span class='recentListingTag'>Recent: </span>":"",preppedHTMLstring+='<div class="listing '+listingClass+'">',"reddit"!==serviceInfoObject.name&&(preppedHTMLstring+='<div style="float:right;"> <a target="_blank" href="'+serviceInfoObject.userPageBaselink+listing.author+'"> by '+listing.author+"</a> </div>"),preppedHTMLstring+='<a class="listingTitle" target="_blank" href="'+serviceInfoObject.permalinkBase+listing.kiwi_permaId+'"><span style="color:black;">'+recentTag,preppedHTMLstring+=null!=listing.over_18&&listing.over_18===!0?'<span class="nsfw">NSFW</span>'+listing.title+"<br>":listing.title+"<br>",preppedHTMLstring+=listing.num_comments+" comments, "+listing.kiwi_score+" upvotes "+formatTime(listing.kiwi_created_at)+'</span> <br> for Url: <span class="altURL">'+listing.url+"</span> </a>",null!=listing.subreddit&&(preppedHTMLstring+='<br><span> <a target="_blank" href="'+serviceInfoObject.permalinkBase+"/r/"+listing.subreddit+'"> subreddit: '+listing.subreddit+'</a></span> <div style="float:right;"> <a target="_blank" href="'+serviceInfoObject.userPageBaselink+listing.author+'"> by '+listing.author+"</a> </div>"),preppedHTMLstring+="<br></div>");preppedHTMLstring+="</span>"}return preppedHTMLstring+="</div>"},bindGoToViewButtons=function(buttonEls,viewName,viewData){var el,_i,_len,_results;for(_results=[],_i=0,_len=buttonEls.length;_len>_i;_i++)el=buttonEls[_i],_results.push($(el).bind("click",function(ev){return switchViews[viewName].render(viewData)}));return _results},receiveParcel=function(parcel){if(null==parcel.msg)return!1;switch(parcel.msg){case"kiwiPP_popupParcel_ready":return initialize(parcel.popupParcel)}},sendParcel=function(parcel){if(null==parcel.msg)return!1;switch(parcel.msg){case"kiwiPP_refreshSearchQuery":return self.port.emit("kiwiPP_refreshSearchQuery",parcel);case"kiwiPP_post_customSearch":return self.port.emit("kiwiPP_post_customSearch",parcel);case"kiwiPP_request_popupParcel":return self.port.emit("kiwiPP_request_popupParcel",parcel);case"kiwiPP_post_savePopupParcel":return self.port.emit("kiwiPP_post_savePopupParcel",parcel);case"kiwiPP_post_save_a_la_carte":return self.port.emit("kiwiPP_post_save_a_la_carte",parcel);case"kiwiPP_clearAllURLresults":return self.port.emit("kiwiPP_clearAllURLresults",parcel);case"kiwiPP_refreshURLresults":return self.port.emit("kiwiPP_refreshURLresults",parcel);case"kiwiPP_researchUrlOverrideButton":return self.port.emit("kiwiPP_researchUrlOverrideButton",parcel)}},self.port.on("kiwi_fromBackgroundToPopup",function(parcel){return receiveParcel(parcel)}),moveArrayElement=function(array,from,to){return array.splice(to,0,array.splice(from,1)[0]),array},getRandom=function(min,max){return min+Math.floor(Math.random()*(max-min+1))},formatTime=function(utcMillisecondTimestamp){var a,amOrPm,date,hour,min,month,months,sec,time,year;return a=new Date(utcMillisecondTimestamp),months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],year=a.getFullYear(),month=months[a.getMonth()],date=a.getDate(),hour=a.getHours(),min=a.getMinutes(),sec=a.getSeconds(),amOrPm=hour>11?"pm":"am",hour>12?hour-=12:0===parseInt(hour)&&(hour=12),10>min&&(min="0"+min),time=month+" "+date+", "+year+" - "+hour+":"+min+amOrPm},renderExtensionHeight=function(elementSelector,extraPx){var extHeight_;return viewElementId===elementSelector?(extraPx=2,extHeight_=$(elementSelector).outerHeight()+extraPx,extHeight_>590&&(extHeight_=590),$("body").css("height",extHeight_+"px"),heightString=extHeight_.toString()+"px",$("html").css("min-height",heightString),extHeight_--,$("body").css("min-height",heightString)):void 0},capitalizeFirstLetter=function(string){return string.charAt(0).toUpperCase()+string.slice(1)},htmlEntities=function(str){return String(str).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},getURLParam=function(oTarget,sVar){return decodeURI(oTarget.search.replace(new RegExp("^(?:.*[&\\?]"+encodeURI(sVar).replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"))}})}).call(this);